# üîß Fix Deployment Error - Missing MONGO_URI

## Error Description

Your deployment failed with this error:
```
ValidationError: 1 validation error for Settings
MONGO_URI
  Field required [type=missing, input_value={...}, input_type=dict]
```

**Cause:** The `MONGO_URI` environment variable was not set during Blueprint deployment.

## üöÄ Quick Fix (5 minutes)

### Option 1: Add Environment Variable in Render Dashboard (Recommended)

1. **Go to your backend service**:
   - Visit: https://dashboard.render.com
   - Click on `smart-ml-backend` service

2. **Add the missing environment variable**:
   - Click **Environment** in the left sidebar
   - Click **Add Environment Variable**
   - Enter:
     - **Key**: `MONGO_URI`
     - **Value**: `mongodb+srv://Harshal:Harshal%40123@cluster0.hguakgq.mongodb.net/smartml?appName=Cluster0`
   - Click **Save Changes**

3. **Service will auto-redeploy**:
   - Wait 2-3 minutes
   - Service should start successfully
   - Check logs for "Application startup complete"

4. **Verify deployment**:
   - Visit: `https://smart-ml-backend.onrender.com/health`
   - Should return: `{"status": "healthy"}`

### Option 2: Re-deploy Blueprint with Environment Variables

If Option 1 doesn't work, delete and recreate:

1. **Delete the failed services**:
   - Go to Render Dashboard
   - For each service (`smart-ml-backend`, `smart-ml-frontend`):
     - Click service ‚Üí Settings ‚Üí Scroll down
     - Click "Delete Service"

2. **Re-deploy Blueprint**:
   - Click **New +** ‚Üí **Blueprint**
   - Connect your repository again
   - **IMPORTANT**: When prompted for environment variables, enter:

   | Variable | Value |
   |----------|-------|
   | `MONGO_URI` | `mongodb+srv://Harshal:Harshal%40123@cluster0.hguakgq.mongodb.net/smartml?appName=Cluster0` |
   | `CORS_ORIGINS` | Leave empty |
   | `GOOGLE_CLIENT_ID` | Leave empty |
   | `GOOGLE_CLIENT_SECRET` | Leave empty |
   | `GOOGLE_REDIRECT_URI` | Leave empty |

   **Note:** `SECRET_KEY` is auto-generated by Render, you don't need to enter it.

3. **Click Apply** and wait for deployment

## üîç Why This Happened

In the `render.yaml` file, environment variables marked with `sync: false` require manual input:

```yaml
- key: MONGO_URI
  sync: false  # This means you must provide the value
```

When deploying via Blueprint, Render prompts you to enter these values. If skipped or missed, the deployment fails.

## ‚úÖ After Fix - Complete Setup

Once the backend is running:

### 1. Update CORS Configuration

The backend needs to know your frontend URL:

1. Go to `smart-ml-backend` service
2. Click **Environment**
3. Find `CORS_ORIGINS` variable
4. Click edit
5. Enter your frontend URL: `https://smart-ml-frontend.onrender.com`
6. Click **Save Changes**
7. Wait for redeploy (2-3 minutes)

### 2. Test Your Application

1. **Backend Health Check**:
   ```
   https://smart-ml-backend.onrender.com/health
   ```
   Should return: `{"status": "healthy"}`

2. **Frontend**:
   ```
   https://smart-ml-frontend.onrender.com
   ```
   Should load the application

3. **Test Features**:
   - Register a new account
   - Login
   - Create a chat
   - Upload a dataset

## üêõ Still Having Issues?

### Check MongoDB Atlas Configuration

1. **Network Access**:
   - Go to https://cloud.mongodb.com
   - Click **Network Access**
   - Verify `0.0.0.0/0` is in the IP Access List
   - If not: Click **Add IP Address** ‚Üí **Allow Access from Anywhere**

2. **Database Access**:
   - Click **Database Access**
   - Verify user "Harshal" exists
   - Ensure permissions: "Read and write to any database"

3. **Test Connection**:
   - Try connecting from your local machine
   - Verify the connection string works

### Check Render Logs

1. Go to `smart-ml-backend` service
2. Click **Logs** tab
3. Look for specific error messages
4. Common errors:
   - "Authentication failed" ‚Üí Check MongoDB username/password
   - "Server selection timeout" ‚Üí Check MongoDB Network Access
   - "Connection refused" ‚Üí Check MongoDB cluster is running

### Verify Environment Variables

In Render Dashboard ‚Üí Backend Service ‚Üí Environment, ensure these are set:

| Variable | Status | Example Value |
|----------|--------|---------------|
| `MONGO_URI` | ‚úÖ Set | `mongodb+srv://Harshal:...` |
| `SECRET_KEY` | ‚úÖ Auto-generated | (Render generates this) |
| `ALGORITHM` | ‚úÖ Set | `HS256` |
| `ACCESS_TOKEN_EXPIRE_MINUTES` | ‚úÖ Set | `30` |
| `ENVIRONMENT` | ‚úÖ Set | `production` |
| `CORS_ORIGINS` | ‚ö†Ô∏è Update after frontend deploys | `https://smart-ml-frontend.onrender.com` |

## üìù Your Credentials (For Reference)

**MongoDB Connection String:**
```
mongodb+srv://Harshal:Harshal%40123@cluster0.hguakgq.mongodb.net/smartml?appName=Cluster0
```

**Important Notes:**
- Password `Harshal@123` is URL-encoded as `Harshal%40123`
- Database name is `smartml`
- Cluster is `cluster0.hguakgq.mongodb.net`

## üîÑ Alternative: Manual Service Creation

If Blueprint keeps failing, you can create services manually:

### Create Backend Service Manually:

1. **New Web Service**:
   - Click **New +** ‚Üí **Web Service**
   - Connect repository: `smart-ml-assistant`
   - Configure:
     - **Name**: `smart-ml-backend`
     - **Root Directory**: `backend`
     - **Runtime**: Python 3
     - **Build Command**: `pip install -r requirements.txt`
     - **Start Command**: `uvicorn app.main:app --host 0.0.0.0 --port $PORT`

2. **Add Environment Variables**:
   - Click **Advanced**
   - Add each variable:
     ```
     MONGO_URI=mongodb+srv://Harshal:Harshal%40123@cluster0.hguakgq.mongodb.net/smartml?appName=Cluster0
     SECRET_KEY=rRSooDw_EKXFTyH9QGx6LNTWUoHWdz2UeEu1IwBGnCs
     ALGORITHM=HS256
     ACCESS_TOKEN_EXPIRE_MINUTES=30
     ENVIRONMENT=production
     CORS_ORIGINS=
     ```

3. **Create Web Service** and wait for deployment

### Create Frontend Service Manually:

1. **New Static Site**:
   - Click **New +** ‚Üí **Static Site**
   - Connect repository: `smart-ml-assistant`
   - Configure:
     - **Name**: `smart-ml-frontend`
     - **Root Directory**: `frontend`
     - **Build Command**: `npm install && npm run build`
     - **Publish Directory**: `dist/public`

2. **Create Static Site** and wait for deployment

3. **Update Backend CORS** with the frontend URL

## üìû Need More Help?

- Check Render logs for detailed error messages
- Verify MongoDB Atlas is configured correctly
- Ensure all environment variables are set
- Try the manual service creation approach

---

**Quick Action:** Go to Render Dashboard ‚Üí smart-ml-backend ‚Üí Environment ‚Üí Add `MONGO_URI` ‚Üí Save
